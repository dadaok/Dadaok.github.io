---
layout:   post
title:    "EKS"
subtitle: "EKS ÌïôÏäµ"
category: AWS
more_posts: posts.md
tags:     AWS
---
# [AWS-EKS] IAM ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Î∞è CloudFormationÏùÑ ÌÜµÌïú Ïù∏ÌîÑÎùº Î∞∞Ìè¨

<!--more-->
<!-- Table of contents -->
* this unordered seed list will be replaced by the toc
{:toc}



## Introduction

EKSÎ•º Î∞∞Ìè¨ÌïòÎäî Î∞©Î≤ïÏóêÎäî 3Í∞ÄÏßÄÍ∞Ä ÏûàÎã§Í≥† ÌñàÎã§. (Í¥ÄÎ¶¨ÏΩòÏÜî, eksctl, IaC)

Ïó¨Í∏∞ÏÑú Ïö∞Î¶¨Îäî **Í¥ÄÎ¶¨ÏΩòÏÜî** Î∞è **eksctlÏùÑ ÌÜµÌï¥ÏÑú Î∞∞Ìè¨**ÌïòÎäî Î∞©Î≤ïÏóê ÎåÄÌï¥ÏÑú ÏïåÏïÑÎ≥¥ÎèÑÎ°ù Ìï† Í≤ÉÏù¥Îã§.

Î≥∏ Í∏ÄÏóêÏÑúÎäî **Ïù¥Îü¨Ìïú Î∞∞Ìè¨Î•º ÌïòÍ∏∞ ÏúÑÌïú ÏÇ¨Ï†ÑÏûëÏóÖ**Ïù∏ **IAM ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Î∞è CloudFormationÏùÑ ÌÜµÌïú Ïù∏ÌîÑÎùº Î∞∞Ìè¨**Î•º ÏàòÌñâÌï† Í≤ÉÏù¥Îã§.




## ÏÇ¨Ï†Ñ Ï§ÄÎπÑ

>‚úÖ ÌïÑÏàò
üîë IAM ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Î∞è Ïï°ÏÑ∏Ïä§ ÌÇ§ ÏÉùÏÑ± ÏûëÏóÖ


### 1. IAM ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±

- Î£®Ìä∏ Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏó¨ [ÎßÅÌÅ¨](https://us-east-1.console.aws.amazon.com/iamv2/home#/users)Ïóê ÌÅ¥Î¶≠ÌïòÏó¨ IAM ÏÇ¨Ïö©Ïûê ÌéòÏù¥ÏßÄÏóê ÏßÑÏûÖÌï©ÎãàÎã§.
- `ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- **ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ**ÏùÄ adminÏúºÎ°ú ÏûÖÎ†•ÌïòÍ≥† [AWS Management ConsoleÏóê ÎåÄÌïú ÏÇ¨Ïö©Ïûê Ïï°ÏÑ∏Ïä§ Í∂åÌïú Ï†úÍ≥µ]ÏùÑ Ï≤¥ÌÅ¨Ìï©ÎãàÎã§.
- **ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏΩòÏÜî Ïï°ÏÑ∏Ïä§ Í∂åÌïú Ï†úÍ≥µ**ÏùÄ [IAM ÏÇ¨Ïö©ÏûêÎ•º ÏÉùÏÑ±ÌïòÍ≥† Ïã∂Ïùå]ÏùÑ ÏÑ†ÌÉùÌï©ÎãàÎã§.
- **ÏΩòÏÜî ÏïîÌò∏**Îäî [ÏÇ¨Ïö©Ïûê ÏßÄÏ†ï ÏïîÌò∏]Î•º ÏÑ†ÌÉùÌïòÍ≥† ÏÉùÏÑ± Í∏∞Ï§ÄÏóê ÎßûÏ∂∞ Í∞ÅÏûê ÏïîÌò∏Î•º ÏßÄÏ†ïÌï©ÎãàÎã§.
- `ÏÇ¨Ïö©ÏûêÎäî Îã§Ïùå Î°úÍ∑∏Ïù∏ Ïãú ÏÉà ÏïîÌò∏Î•º ÏÉùÏÑ±Ìï¥Ïïº Ìï©ÎãàÎã§.`Î•º Ï≤¥ÌÅ¨ Ìï¥Ï†úÌïòÍ≥† `Îã§Ïùå` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- **Í∂åÌïú ÏòµÏÖò**ÏùÄ [ÏßÅÏ†ë Ï†ïÏ±Ö Ïó∞Í≤∞]ÏùÑ ÏÑ†ÌÉùÌïòÍ≥† Í∂åÌïú Ï†ïÏ±ÖÏóêÏÑú [AdministratorAccess]Î•º Ï≤¥ÌÅ¨Ìïú ÌõÑ ÏïÑÎûò `Îã§Ïùå` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- Í≤ÄÌÜ† Î∞è ÏÉùÏÑ± ÌéòÏù¥ÏßÄÏóêÏÑú `ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- ÏïîÌò∏ Í≤ÄÏÉâ ÌéòÏù¥ÏßÄÏóêÏÑú `.csv ÌååÏùº Îã§Ïö¥Î°úÎìú` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏûêÏã†Ïùò PCÏùò ÎîîÎ†âÌÑ∞Î¶¨Ïóê Ï†ÄÏû•Ìï©ÎãàÎã§.
- `ÏÇ¨Ïö©Ïûê Î™©Î°ùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ IAM ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±ÏùÑ ÎßàÎ¨¥Î¶¨Ìï©ÎãàÎã§.


### 2. IAM ÏÇ¨Ïö©Ïûê Ïï°ÏÑ∏Ïä§ ÌÇ§ ÏÉùÏÑ±

- IAM ÏÇ¨Ïö©Ïûê ÌéòÏù¥ÏßÄÏóêÏÑú `ÏÉùÏÑ±Ìïú ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ`ÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- `Î≥¥Ïïà ÏûêÍ≤© Ï¶ùÎ™Ö` ÌÉ≠ÏùÑ ÌÅ¥Î¶≠ÌïòÍ≥† [Ïï°ÏÑ∏Ïä§ ÌÇ§] ÏòÅÏó≠ÏóêÏÑú `Ïï°ÏÑ∏Ïä§ ÌÇ§ ÎßåÎì§Í∏∞` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- Ïï°ÏÑ∏Ïä§ ÌÇ§ Î™®Î≤î ÏÇ¨Î°Ä Î∞è ÎåÄÏïà ÌéòÏù¥ÏßÄÏóêÏÑú **[Command Line Interface(CLI)]**Î•º ÏÑ†ÌÉùÌïòÍ≥† ÏïÑÎûò Ï≤¥ÌÅ¨ Î∞ïÏä§Î•º Ï≤¥ÌÅ¨Ìïú ÌõÑ `Îã§Ïùå` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- `Ïï°ÏÑ∏Ïä§ ÌÇ§ ÎßåÎì§Í∏∞` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.
- Ïï°ÏÑ∏Ïä§ ÌÇ§ Í≤ÄÏÉâ ÌéòÏù¥ÏßÄÏóêÏÑú `.csv ÌååÏùº Îã§Ïö¥Î°úÎìú` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏûêÏã†Ïùò PCÏùò ÎîîÎ†âÌÑ∞Î¶¨Ïóê Ï†ÄÏû•Ìï©ÎãàÎã§.
- `ÏôÑÎ£å` Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ IAM ÏÇ¨Ïö©Ïûê Ïï°ÏÑ∏Ïä§ ÌÇ§ ÏÉùÏÑ±ÏùÑ ÎßàÎ¨¥Î¶¨Ìï©ÎãàÎã§.

>Note: IAM ÏÇ¨Ïö©ÏûêÎ°ú Í¥ÄÎ¶¨ ÏΩòÏÜîÏóê Î°úÍ∑∏Ïù∏ Ìï†Îïå Í≥ÑÏ†ï IDÍ∞Ä ÌïÑÏöîÌïòÎãà Ïûò Î©îÎ™®Ìï¥ Îë°ÎãàÎã§.


---
## CloudFormationÏúºÎ°ú Í∏∞Î≥∏ Ïù∏ÌîÑÎùº Î∞∞Ìè¨
![](/assets/img/AWS/eks/f9bd4b1a-40ac-458b-818b-595a4e328fcc-image.png)

Î®ºÏ†Ä CloudFormationÏùÑ ÌÜµÌï¥ÏÑú Í∏∞Î≥∏Ï†ÅÏù∏ VPC Î∞è my-eks-host ÎùºÎäî Î∞∞Ïä§Ï≤ú Ìò∏Ïä§Ìä∏Î•º ÎßåÎì†Îã§. Ïù¥ Î∞∞Ïä§Ï≤ú Ìò∏Ïä§Ìä∏Î•º ÌÜµÌï¥ÏÑú Ïö∞Î¶¨Îäî EKS ÌôòÍ≤ΩÏùÑ ÎßåÎì§Í≥† Ï†ëÍ∑ºÌïòÏó¨ ÏûëÏóÖÌïòÍ≤å ÎêúÎã§.

> AWS CloudFormation ÏÉùÏÑ± : [CloudFormation](https://console.aws.amazon.com/cloudformation/home?region=ap-northeast-2#/stacks/new?stackName=myeks&templateURL=https:%2F%2Fdadaok.github.io%2Fassets%2Fyaml%2Fcnaeb_ch1_lab_1.yaml)

<details>
  <summary>cnaeb_ch1_lab_1.yaml ÏΩîÎìú Î≥¥Í∏∞</summary>
  <pre><code class="language-yaml">

AWSTemplateFormatVersion: '2010-09-09'

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: "<<<<< EKSCTL MY EC2 >>>>>"
        Parameters:
          - ClusterBaseName
          - KeyName
          - SgIngressSshCidr
          - MyInstanceType
          - LatestAmiId
      - Label:
          default: "<<<<< Region AZ >>>>>"
        Parameters:
          - TargetRegion
          - AvailabilityZone1
          - AvailabilityZone2
      - Label:
          default: "<<<<< VPC Subnet >>>>>"
        Parameters:
          - VpcBlock
          - PublicSubnet1Block
          - PublicSubnet2Block
          - PrivateSubnet1Block
          - PrivateSubnet2Block

Parameters:
  ClusterBaseName:
    Type: String
    Default: myeks
    AllowedPattern: "[a-zA-Z][-a-zA-Z0-9]*"
    Description: must be a valid Allowed Pattern '[a-zA-Z][-a-zA-Z0-9]*'
    ConstraintDescription: ClusterBaseName - must be a valid Allowed Pattern

  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instances. Linked to AWS Parameter
    Type: AWS::EC2::KeyPair::KeyName
    ConstraintDescription: must be the name of an existing EC2 KeyPair.

  SgIngressSshCidr:
    Description: The IP address range that can be used to communicate to the EC2 instances
    Type: String
    MinLength: '9'
    MaxLength: '18'
    Default: 0.0.0.0/0
    AllowedPattern: (\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})
    ConstraintDescription: must be a valid IP CIDR range of the form x.x.x.x/x.

  MyInstanceType:
    Description: Enter t2.micro, t2.small, t2.medium, t3.micro, t3.small, t3.medium. Default is t2.micro.
    Type: String
    Default: t3.medium
    AllowedValues:
      - t2.micro
      - t2.small
      - t2.medium
      - t3.micro
      - t3.small
      - t3.medium

  LatestAmiId:
    Description: (DO NOT CHANGE)
    Type: 'AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>'
    Default: '/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2'
    AllowedValues:
      - /aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2

  TargetRegion:
    Type: String
    Default: ap-northeast-2

  AvailabilityZone1:
    Type: String
    Default: ap-northeast-2a

  AvailabilityZone2:
    Type: String
    Default: ap-northeast-2c

  VpcBlock:
    Type: String
    Default: 192.168.0.0/16

  PublicSubnet1Block:
    Type: String
    Default: 192.168.1.0/24

  PublicSubnet2Block:
    Type: String
    Default: 192.168.2.0/24

  PrivateSubnet1Block:
    Type: String
    Default: 192.168.3.0/24

  PrivateSubnet2Block:
    Type: String
    Default: 192.168.4.0/24

Resources:
  # VPC
  EksVPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: !Ref VpcBlock
      EnableDnsSupport: true
      EnableDnsHostnames: true
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-VPC

  # PublicSubnets
  PublicSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone: !Ref AvailabilityZone1
      CidrBlock: !Ref PublicSubnet1Block
      VpcId: !Ref EksVPC
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-PublicSubnet1
        - Key: kubernetes.io/role/elb
          Value: 1

  PublicSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone: !Ref AvailabilityZone2
      CidrBlock: !Ref PublicSubnet2Block
      VpcId: !Ref EksVPC
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-PublicSubnet2
        - Key: kubernetes.io/role/elb
          Value: 1

  InternetGateway:
    Type: AWS::EC2::InternetGateway

  VPCGatewayAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      InternetGatewayId: !Ref InternetGateway
      VpcId: !Ref EksVPC

  PublicSubnetRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref EksVPC
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-PublicSubnetRouteTable

  PublicSubnetRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref PublicSubnetRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway

  PublicSubnet1RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet1
      RouteTableId: !Ref PublicSubnetRouteTable

  PublicSubnet2RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet2
      RouteTableId: !Ref PublicSubnetRouteTable

  # PrivateSubnets
  PrivateSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone: !Ref AvailabilityZone1
      CidrBlock: !Ref PrivateSubnet1Block
      VpcId: !Ref EksVPC
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-PrivateSubnet1
        - Key: kubernetes.io/role/internal-elb
          Value: 1

  PrivateSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone: !Ref AvailabilityZone2
      CidrBlock: !Ref PrivateSubnet2Block
      VpcId: !Ref EksVPC
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-PrivateSubnet2
        - Key: kubernetes.io/role/internal-elb
          Value: 1

  PrivateSubnetRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref EksVPC
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-PrivateSubnetRouteTable

  PrivateSubnet1RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet1
      RouteTableId: !Ref PrivateSubnetRouteTable

  PrivateSubnet2RouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet2
      RouteTableId: !Ref PrivateSubnetRouteTable

  # EKSCTL-Host
  EKSEC2SG:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: eksctl-host Security Group
      VpcId: !Ref EksVPC
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-HOST-SG
      SecurityGroupIngress:
        - IpProtocol: '-1'
          #FromPort: '22'
          #ToPort: '22'
          CidrIp: !Ref SgIngressSshCidr

  EKSEC2:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: !Ref MyInstanceType
      ImageId: !Ref LatestAmiId
      KeyName: !Ref KeyName
      Tags:
        - Key: Name
          Value: !Sub ${ClusterBaseName}-host
      NetworkInterfaces:
        - DeviceIndex: 0
          SubnetId: !Ref PublicSubnet1
          GroupSet:
            - !Ref EKSEC2SG
          AssociatePublicIpAddress: true
          PrivateIpAddress: 192.168.1.100
      BlockDeviceMappings:
        - DeviceName: /dev/xvda
          Ebs:
            VolumeType: gp3
            VolumeSize: 20
            DeleteOnTermination: true
      UserData:
        Fn::Base64:
          !Sub |
          #!/bin/bash
          hostnamectl --static set-hostname "${ClusterBaseName}-host"

          # Config convenience
          echo 'alias vi=vim' >> /etc/profile
          echo "sudo su -" >> /home/ec2-user/.bashrc

          # Change Timezone
          sed -i "s/UTC/Asia\/Seoul/g" /etc/sysconfig/clock
          ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime

          # Install Packages
          cd /root
          yum -y install tree jq git htop lynx

          # Install kubectl & helm
          #curl -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.26.2/2023-03-17/bin/linux/amd64/kubectl
          curl -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.25.7/2023-03-17/bin/linux/amd64/kubectl
          install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
          curl -s https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash

          # Install eksctl
          curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp
          mv /tmp/eksctl /usr/local/bin

          # Install aws cli v2
          curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
          unzip awscliv2.zip >/dev/null 2>&1
          sudo ./aws/install
          complete -C '/usr/local/bin/aws_completer' aws
          echo 'export AWS_PAGER=""' >>/etc/profile
          export AWS_DEFAULT_REGION=${AWS::Region}
          echo "export AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION" >> /etc/profile

          # Install YAML Highlighter
          wget https://github.com/andreazorzetto/yh/releases/download/v0.4.0/yh-linux-amd64.zip
          unzip yh-linux-amd64.zip
          mv yh /usr/local/bin/

          # Install krew
          curl -LO https://github.com/kubernetes-sigs/krew/releases/download/v0.4.3/krew-linux_amd64.tar.gz
          tar zxvf krew-linux_amd64.tar.gz
          ./krew-linux_amd64 install krew
          export PATH="$PATH:/root/.krew/bin"
          echo 'export PATH="$PATH:/root/.krew/bin"' >> /etc/profile

          # Install kube-ps1
          echo 'source <(kubectl completion bash)' >> /etc/profile
          echo 'alias k=kubectl' >> /etc/profile
          echo 'complete -F __start_kubectl k' >> /etc/profile

          git clone https://github.com/jonmosco/kube-ps1.git /root/kube-ps1
          cat <<"EOT" >> /root/.bash_profile
          source /root/kube-ps1/kube-ps1.sh
          KUBE_PS1_SYMBOL_ENABLE=false
          function get_cluster_short() {
            echo "$1" | cut -d . -f1
          }
          KUBE_PS1_CLUSTER_FUNCTION=get_cluster_short
          KUBE_PS1_SUFFIX=') '
          PS1='$(kube_ps1)'$PS1
          EOT

          # Install krew plugin
          kubectl krew install ctx ns get-all  # ktop df-pv mtail tree

          # Install node-shell
          curl -LO https://github.com/kvaps/kubectl-node-shell/raw/master/kubectl-node_shell
          chmod +x ./kubectl-node_shell
          sudo mv ./kubectl-node_shell /usr/local/bin/kubectl-node_shell

          # Install Docker
          amazon-linux-extras install docker -y
          systemctl start docker && systemctl enable docker

          # CLUSTER_NAME
          export CLUSTER_NAME=${ClusterBaseName}
          echo "export CLUSTER_NAME=$CLUSTER_NAME" >> /etc/profile

          # Create SSH Keypair
          ssh-keygen -t rsa -N "" -f /root/.ssh/id_rsa

Outputs:
  eksctlhost:
    Value: !GetAtt EKSEC2.PublicIp

</code>
</pre>
</details>

  
Í∑∏ÎåÄÎ°ú CloudFormationÏùÑ ÏÉùÏÑ±Ìï¥Ï£ºÎ©¥ ÎêúÎã§.

>**‚ö† Ï£ºÏùò ÏÇ¨Ìï≠**
- IAM Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏Ìïú ÌõÑ Ïï°ÏÑ∏Ïä§ ÌÇ§Î•º Î∞úÍ∏âÎ∞õÏùÄ ÏÉÅÌÉúÏóêÏÑú ÏßÑÌñâÌïúÎã§.
- SSH Ï†ëÏÜçÏùÑ ÏúÑÌïú [EC2-KeyPair](https://ap-northeast-2.console.aws.amazon.com/ec2/home?region=ap-northeast-2#KeyPairs:)Í∞Ä Î∞úÍ∏âÎêòÏñ¥ ÏûàÏñ¥Ïïº ÌïúÎã§.

![](/assets/img/AWS/eks/a29163b9-a821-44e9-8cd4-fe7ab04b56b2-image.png)

Ïù¥ Îïå, ÎØ∏Î¶¨ Î∞úÍ∏âÎ∞õÏïÑ ÎëêÏóàÎçò EC2 key ÌéòÏñ¥Í∞Ä ÌïÑÏöîÌïòÎã§.
ÌÇ§ÌéòÏñ¥Í∞Ä ÏóÜÎã§Î©¥ [EC2-KeyPair](https://ap-northeast-2.console.aws.amazon.com/ec2/home?region=ap-northeast-2#KeyPairs:)ÏóêÏÑú ÏÉùÏÑ±Ìï¥ Ï£ºÎèÑÎ°ù ÌïòÏûê.
![](/assets/img/AWS/eks/9c7b875e-e5f7-4033-91d9-b39487cef1b5-image.png)


Ïù¥Í≥ºÏ†ïÏù¥ ÏôÑÎ£åÎêòÎ©¥ Îã§ÏùåÏùÄ Î∂ÄÎ∂ÑÎì§Ïù¥** Ï†ÑÎ∂Ä ÌïúÎ≤àÏóê Î∞∞Ìè¨Í∞Ä ÏôÑÎ£å**Îêú Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.
![](/assets/img/AWS/eks/d2ff8b94-45a2-4e44-b930-a072acc2f51e-image.png)


### Î∞∞Ïä§Ï≤ú Ìò∏Ïä§Ìä∏(EC2) Ï†ëÏÜç


Ïù¥Ï†ú Í¥ÄÎ¶¨Î•º ÏúÑÌï¥ÏÑú ÏÉùÏÑ±Ìï¥Îëî EC2 Ïù∏Ïä§ÌÑ¥Ïä§Ïóê Ï†ëÏÜçÌï¥Î≥¥Ïûê.
ÎÇ¥ Î°úÏª¨ Ïª¥Ìì®ÌÑ∞ CMDÎ•º Ïó¥Í≥†, Í∞ÅÏûêÏùò SSH ÌÇ§Ïóê Ìï¥ÎãπÌïòÎäî Ï†ëÏÜçÏùÑ ÌïòÎ©¥ÎêúÎã§.

- ssh Î™ÖÎ†πÏñ¥ ÌôïÏù∏
![](/assets/img/AWS/eks/5049c26d-04df-4eaf-bb8a-e8973b62259b-image.png)

- Ï†ëÏÜç ÏÑ±Í≥µ
![](/assets/img/AWS/eks/029d41c7-53fa-462a-8361-265c7d0890ca-image.png)



### ‚úÖ ÏÑ§Ïπò ÌôïÏù∏

Ï†ëÏÜçÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏôÑÎ£åÎêòÏóàÎã§Î©¥, Ïù¥Ï†ú Ï†úÎåÄÎ°ú ÏÑ§ÏπòÍ∞Ä ÏôÑÎ£åÎêòÏóàÎäîÏßÄ ÌôïÏù∏Ìï¥ Î≥¥Ïûê.

>`Ctrl + V` Î™ÖÎ†πÏù¥ ÎèôÏûëÌïòÏßÄ ÏïäÎäîÎã§Î©¥, **ÎßàÏö∞Ïä§ Ïò§Î•∏Ï™ΩÏùÑ ÌÅ¥Î¶≠**ÌïòÎ©¥ ÎêúÎã§. 
Î≥µÏÇ¨Ìï† ÎïåÎèÑ Ï≠â ÎìúÎûòÍ∑∏ÌïòÍ≥†  **ÎßàÏö∞Ïä§ Ïò§Î•∏Ï™ΩÏùÑ ÌÅ¥Î¶≠**ÌïòÎ©¥ ÎêúÎã§.

#### ÏÇ¨Ïö©Ïûê ÌôïÏù∏

```bash
whoami
```
whoamiÎ•º ÏûÖÎ†•ÌïòÏó¨ root ÏÇ¨Ïö©ÏûêÏûÑÏùÑ ÌôïÏù∏Ìï©ÎãàÎã§.

>Note: root ÏÇ¨Ïö©ÏûêÎ°ú Ï†ÑÌôòÌïòÎèÑÎ°ù ÎØ∏Î¶¨ ÏÑ§Ï†ïÌï¥ ÎëêÏóàÏúºÎ©∞, Ï†ëÏÜç ÌÉÄÏù¥Î∞çÏóê Îî∞Îùº ec2-user ÏÇ¨Ïö©ÏûêÎùºÎ©¥ sudo su -Î•º ÏûÖÎ†•ÌïòÏó¨ root ÏÇ¨Ïö©ÏûêÎ°ú Ï†ÑÌôòÌï©ÎãàÎã§.

![](/assets/img/AWS/eks/2017d53e-8b35-4ef6-b007-f466e2e8c8de-image.png)


#### Í∏∞Î≥∏ ÏÑ§Ïπò ÎèÑÍµ¨ ÌôïÏù∏

```bash
// kubectl Î≤ÑÏ†Ñ ÌôïÏù∏
kubectl version --client=true -o yaml | yh

// eksctl Î≤ÑÏ†Ñ ÌôïÏù∏
eksctl version

// awscli Î≤ÑÏ†Ñ ÌôïÏù∏
aws --version

// ÎèÑÏª§ Ï†ïÎ≥¥ ÌôïÏù∏
docker info | yh
```
![](/assets/img/AWS/eks/a5314383-1e25-495a-8e8b-be33c8058616-image.png)


#### awscli ÏÇ¨Ïö©ÏùÑ ÏúÑÌïú IAM ÏûêÍ≤© Ï¶ùÎ™Ö

```bash
// awscliÎ°ú Ïù∏Ïä§ÌÑ¥Ïä§ Ï†ïÎ≥¥ ÌôïÏù∏ (IAM ÏûêÍ≤© Ï¶ùÎ™Ö X)
aws ec2 describe-instances | jq

// IAM ÏÇ¨Ïö©Ïûê ÏûêÍ≤© Íµ¨ÏÑ±
aws configure

// awscliÎ°ú Ïù∏Ïä§ÌÑ¥Ïä§ Ï†ïÎ≥¥ Îã§Ïãú ÌôïÏù∏ (IAM ÏûêÍ≤© Ï¶ùÎ™Ö O)
aws ec2 describe-instances | jq
```
IAM ÏÇ¨Ïö©ÏûêÏùò Ïï°ÏÑ∏Ïä§ ÌÇ§ ÏÉùÏÑ±Ìï† Îïå Ï†ÄÏû•Ìïú xxxx_accesskeys.csv ÌååÏùºÏùÑ Ïó¥Ïñ¥ Í∞íÏùÑ Ï∞∏Ï°∞Ìï©ÎãàÎã§. csvÎ°ú Ïï°ÏÑ∏Ïä§ÌÇ§ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ï†ÄÏû•ÌïòÏßÄ ÏïäÏïòÎã§Î©¥, ÌÇ§Î•º Îã§Ïãú ÏÉùÏÑ±ÌïòÎ©¥ Îê©ÎãàÎã§.

aws configureÎ•º ÏûÖÎ†•ÌïòÏó¨ `Access Key ID`, `Secret Access Key`, `Region` ÏΩîÎìúÎ•º ÏûÖÎ†•Ìï©ÎãàÎã§.

![](/assets/img/AWS/eks/38315abe-91c3-43bf-a7f9-35bf7ebf1557-image.png)


IAM ÏûêÍ≤© Ï¶ùÎ™ÖÏù¥ Ïù¥Î£®Ïñ¥ÏßÄÎ©¥ awscli ÎèÑÍµ¨Î°ú Ïù∏Ïä§ÌÑ¥Ïä§ Ï†ïÎ≥¥Î•º Îã§Ïãú ÌôïÏù∏Ìï©ÎãàÎã§.

#### EKS Î∞∞Ìè¨Ìï† VPC Ï†ïÎ≥¥ ÌôïÏù∏

```bash
// CLUSTER_NAME Î≥ÄÏàò ÌôïÏù∏
echo $CLUSTER_NAME

// EKSÎ•º Î∞∞Ìè¨Ìï† myeks-VPC Ï†ïÎ≥¥ ÌôïÏù∏
aws ec2 describe-vpcs --filters "Name=tag:Name,Values=$CLUSTER_NAME-VPC" | jq

// EKSÎ•º Î∞∞Ìè¨Ìï† myeks-VPC ID Í∞íÎßå ÌôïÏù∏
aws ec2 describe-vpcs --filters "Name=tag:Name,Values=$CLUSTER_NAME-VPC" | jq -r .Vpcs[].VpcId
```
![](/assets/img/AWS/eks/db418259-f203-49dc-a941-b7e211bead7f-image.png)

#### EKS Î∞∞Ìè¨Ìï† VPC ID Î≥ÄÏàò Ï†ÄÏû•

```bash
// VPCID ÎùºÎäî ÌôòÍ≤ΩÎ≥ÄÏàòÎ°ú myeks-VPC ID Í∞íÏùÑ Ï†ÄÏû•
export VPCID=$(aws ec2 describe-vpcs --filters "Name=tag:Name,Values=$CLUSTER_NAME-VPC" | jq -r .Vpcs[].VpcId)

// VPCIDÎ•º Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ†Ïñ∏
echo "export VPCID=$VPCID" >> /etc/profile

// VPCID Î≥ÄÏàò Ìò∏Ï∂ú
echo $VPCID
```
![](/assets/img/AWS/eks/e50495b1-9784-4e3e-8684-121dd255118b-image.png)


#### EKS Î∞∞Ìè¨Ìï† VPCÏùò ÏÑúÎ∏åÎÑ∑ Ï†ïÎ≥¥ ÌôïÏù∏

```bash
// EKSÎ•º Î∞∞Ìè¨Ìï† VPCÏùò Ï†ÑÏ≤¥ ÏÑúÎ∏åÎÑ∑ Ï†ïÎ≥¥ ÌôïÏù∏
aws ec2 describe-subnets --filters "Name=vpc-id,Values=$VPCID" --output json | jq

// EKSÎ•º Î∞∞Ìè¨Ìï† VPCÏùò ÌçºÎ∏îÎ¶≠ ÏÑúÎ∏åÎÑ∑ Ï†ïÎ≥¥ ÌôïÏù∏
aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet1" | jq

aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet2" | jq

// EKSÎ•º Î∞∞Ìè¨Ìï† VPCÏùò ÌçºÎ∏îÎ¶≠ ÏÑúÎ∏åÎÑ∑ ID Í∞íÎßå ÌôïÏù∏
aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet1" --query "Subnets[0].[SubnetId]" --output text

aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet2" --query "Subnets[0].[SubnetId]" --output text
```
![](/assets/img/AWS/eks/6adef347-622c-4907-a6dc-0a843d06585d-image.png)

#### EKS Î∞∞Ìè¨Ìï† ÌçºÎ∏îÎ¶≠ ÏÑúÎ∏åÎÑ∑ ID Î≥ÄÏàò Ï†ÄÏû•

```bash
// Î≥ÄÏàòÏóê ÌçºÎ∏îÎ¶≠ ÏÑúÎ∏åÎÑ∑ ID Í∞íÏùÑ Ï†ÄÏû•
export PubSubnet1=$(aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet1" --query "Subnets[0].[SubnetId]" --output text)

export PubSubnet2=$(aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet2" --query "Subnets[0].[SubnetId]" --output text)

// ÌçºÎ∏îÎ¶≠ ÏÑúÎ∏åÎÑ∑ IDÎ•º Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ†Ïñ∏
echo "export PubSubnet1=$PubSubnet1" >> /etc/profile

echo "export PubSubnet2=$PubSubnet2" >> /etc/profile

// VPCID Î≥ÄÏàò Ìò∏Ï∂ú
echo $PubSubnet1

echo $PubSubnet2
```

#### Î≥ÄÏàò Ìò∏Ï∂ú (Ï¢ÖÌï©)

```bash
echo $AWS_DEFAULT_REGION

echo $CLUSTER_NAME

echo $VPCID

echo $PubSubnet1,$PubSubnet2
```
![](/assets/img/AWS/eks/4db34c73-878b-4205-b3dc-061d1f3be3bd-image.png)


Ïù¥Î•º ÌÜµÌï¥ÏÑú ÏÉùÏÑ±Îêú VPC ÌôòÍ≤Ω Î∞è ÏÑ§ÏπòÎêú CLI ÎèÑÍµ¨Îì§Ïù¥ Ïûò ÏÉùÏÑ±Îêú Í≤ÉÏùÑ ÌôïÏù∏ÌñàÎã§. ÎòêÌïú, Ï∂îÌõÑ ÏÇ¨Ïö©Ìï† ÌôòÍ≤Ω Î≥ÄÏàòÏóêÎèÑ Ïûò ÎÑ£Ïñ¥Ï£ºÎäî ÏûëÏóÖÍπåÏßÄ ÏôÑÎ£åÌñàÎã§.

Ïù¥Ï†ú Îã§Ïùå Í≥ºÏ†ïÏúºÎ°ú Î≥∏Í≤©Ï†ÅÏúºÎ°ú EKSÎ•º Î∞∞Ìè¨Ìï¥Î≥¥ÎèÑÎ°ù ÌïòÏûê.ü§©



---
**Reference codeüìé** | [CloudNet@ÏôÄ Ìï®ÍªòÌïòÎäî Amazon EKS Í∏∞Î≥∏ Í∞ïÏùò](https://cloudneta.github.io/cnaeblab/2023-06-02-CH1/)
